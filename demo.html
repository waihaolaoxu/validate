<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>表单验证插件</title>
<link rel="stylesheet" type="text/css" href="http://www.loveqiao.com/css/public.css">
<style>
.main{width:527px;}
.error-css{ background:#FFD0D0; border:solid 1px #F00}
form p{ display:block; margin:20px 0 0 200px;}
label{ margin-left:10px;}
input{width:150px;height:25px;border:solid 1px #ddd;}
.submit{ width:100px; height:35px;}
</style>
</head>

<body>
<div class="main">
<form id="signupForm" action="/">
    <p><input validate="remote" type="text" placeholder="自定义" /></p>
    <p><input validate="idcard" type="text" maxlength="18" placeholder="身份证" /></p>
    <p><input validate="maxlength" maxlength="5" type="text" placeholder="最大长度5" /></p>
    <p><input validate="minlength" minlength="2" type="text" placeholder="最小长度2" /></p>
    <p><input validate="number" type="text" placeholder="数字" /></p>
    <p><input validate="url" type="text" placeholder="url" /></p>
    <p><input validate="required|phone" type="text" placeholder="必填、手机" /></p>
    <p><input type="submit" class="submit" value="提交" />
</form>
</div>
<script type="text/javascript" src="http://cdn.loveqiao.com/jquery.js"></script>
<script>
$(function(){
	$('#signupForm').verify({
		messages:{required:'此处不能为空',remote:'名字重复请重新输入'},
		validate:{
				remote:function(e){
					
				},
		},
		submitBtn:{
			flag:true,
		}
	})
})
/*
 * 设置点击按钮后验证表单，验证脚本会返回一个布尔值
 * 这种方法适用于ajax提交表单
 
	$(提交按钮id).click(function(){
		var b=$('#signupForm').verify({acticle:true}) 
		alert(b)
	})
	
*/

/*--表单验证/S--*/
;(function($){
	$.fn.verify=function(options){
		//提交按钮状态
		var submitBtn={
			flag:false,
			id:$(this).find("input[type='submit']"),
			txt:'提交中...'
		}
		//验证规则
		var validate={
				required:function(e){
					if(e.val()==''){
						_error(e,'required');
						return false
					}
				},
				email:function(e){
					var reg=/^\w+@([0-9a-zA-Z]+[.])+[a-z]{2,4}$/,val=e.val();
					if(val&&!reg.test(val)){
						_error(e,'email');
						return false
					}
				},
				phone:function(e){
					var reg=/^1[3|5|8|7]\d{9}$/,val=e.val();
					if(val&&!reg.test(val)){
						_error(e,'phone');
						return false
					}
				},
				number:function(e){
					var val=e.val()
					if(val&&isNaN(e.val())){
						_error(e,'number');
						return false
					}
				},
				url:function(e){
					var reg=/^http:\/\/.+\./,val=e.val();
					if(val&&!reg.test(val)){
						_error(e,'url');
						return false
					}
				},
				maxlength:function(e){
					var len=e.attr('maxlength'),val=e.val();
					if(!len){return true}
					if(val&&!(val.length<=len)){
						_error(e,'maxlength');
						return false
					}
				},
				minlength:function(e){
					var len=e.attr('minlength'),val=e.val();
					if(!len){return true}
					if(val&&!(val.length>=len)){
						_error(e,'minlength');
						return false
					}
				},
				idcard:function(e){
					var reg=/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)/,val=e.val();
					if(val&&!reg.test(val)){
						_error(e,'idcard');
						return false	
					}
				}

		}
		//提示信息
		messages = {
			required: "不能为空",
			email: "请输入合法的邮件地址",
			phone:'请输入正确的手机号码',
			url: "请输入合法的 URL地址",
			number: "请输入数字",
			maxlength: '超出字数限制',
			minlength: '字数长度不够',
			idcard:'请输入正确的身份证号码'
		}
		//合并对象
		if(options){
			if(options.messages){
				messages=$.extend(messages,options.messages)
			}
			if(options.validate){
				validate=$.extend(validate,options.validate)
			}
			if(options.submitBtn){
				submitBtn=$.extend(submitBtn,options.submitBtn)
			}
		}
		//错误提示
		window._error=function(obj,error){
			var txt="";
			if(error=='required'&&obj.attr('placeholder')!=undefined){
				txt=obj.attr('placeholder')+messages[error]
			}else{
				txt=messages[error]	
			}
			if(obj.next('.error').length){
				obj.addClass('error-css').next('.error').text(txt).show();

			}else{
				obj.addClass('error-css').after('<label class="error">'+txt+'</label>')
			}
		}
		//校验
		function check(){
			 var rule=$(this).attr('validate').split('|'),
					len=rule.length;
				for(var i=0;i<len;i++){
					if(validate.hasOwnProperty(rule[i])){
						if(validate[rule[i]]($(this))==false){
							return false
							break
						}
					}
				}
		}
		$('[validate]',this).on('focus',function(e) {
			$(this).removeClass('error-css').next('.error').hide();
		})
		$('[validate]',this).on('blur',function(e) {
			check.call(e.currentTarget)
        });
		function yanzheng(){
			var success=true;
			$(this).find('[validate]').each(function(i, e) {
			   if(check.call(e)==false){
					success=false
					return false
			   }
            });
			if(success){
				if(submitBtn.flag){
					submitBtn.id.val(submitBtn.txt)
				}
			}
			return success	
		}
		$(this).submit(yanzheng);
		if(options.acticle){
			return yanzheng.call(this)
		}
	}
})(jQuery);
/*--表单验证/E--*/
</script>
<script src="http://www.loveqiao.com/js/public.js"></script>
</body>
</html>
